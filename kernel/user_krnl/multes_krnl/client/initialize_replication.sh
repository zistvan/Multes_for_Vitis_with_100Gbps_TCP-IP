#will use by default the IPs 11.1.212.161-163, with 161 as leader

PARTIP="10.1.212.15"
NODES="1 2 3"

echo "SETTING UP IN RANGE ${PARTIP}x"

echo "CHECKING PING..."
for x in $NODES
do
    ping -c 2 ${PARTIP}${x}
done

echo "SET IDs ${NODES} ..."

for x in $NODES
do
    # tell them who they are
    MSG="FFFF0${x}1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    echo sending $MSG to ${PARTIP}${x} 
    echo -n ${MSG} | xxd -r -p | nc ${PARTIP}${x} 2880 -w1
done

for x in $NODES
do    
    for y in $NODES
    do
	if [ $x != $y ]
	then
	    SM=$((y+96))
            # tell them who the others are
	    MSG="FFFF0${y}12000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000${SM}D4010A400B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
	    echo sendind $MSG to ${PARTIP}${x}	    
	    echo -n ${MSG} | xxd -r -p | nc ${PARTIP}${x} 2880 -w1
	fi       
    done
done

echo "SET LEADER..."

for x in $NODES
do
    # tell them who the leader is (1)
    MSG="FFFF011400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    echo sending $MSG to ${PARTIP}${x}    
    echo -n ${MSG} | xxd -r -p | nc ${PARTIP}${x} 2880 -w1
done

echo "FLUSH DATA..."

for x in 1 2 3
do
    # flush all the state
    MSG="FFFF00FF010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F12BF20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    echo sending $MSG to ${PARTIP}${x}
    echo -n ${MSG} | xxd -r -p | nc ${PARTIP}${x} 2880 -w2 | xxd
done



echo "...DONE"


